<include file="Public:header" />

<div style="width:980px;margin:auto;">
<h2>{$title}</h2>
<style>
	.pieTabs{
		line-height:26px;width:330px;float:left;
	}
	.pieTabs a {
		color:#0000FF;
	}
</style>
<div style="width:330px;float:left;">
	<span class="pieTabs">
		<a href="javascript:void(0)" id="tab_hard" style="color:red;">硬装费用</a> | <a href="javascript:void(0)" id="tab_soft">软装费用</a>
	</span>
	
	<div id="hard_div">
	<img style="float:left" id="hard_pie_image" />
	<div style="float:left;margin-left:10px;line-height:28px;">
	<foreach name="hard_fields" item="vo" key="field">
	<span style="color:#ffffff;background:{$vo[1]};">{$vo[0]}</span> <span id="scale_{$field}"></span>% <br>
	</foreach>
	</div>
	</div>
	
	<div id="soft_div" style="display:none;">
	<img style="float:left" id="soft_pie_image" />
	<div style="float:left;margin-left:10px;line-height:28px;">
	<foreach name="soft_fields" item="vo" key="field">
	<span style="color:#ffffff;background:{$vo[1]};">{$vo[0]}</span> <span id="scale_{$field}"></span>% <br>
	</foreach>
	</div>
	</div>
</div>
<div style="650px;float:left;line-height:26px;">
建筑面积：{$info.acreage}㎡<br>
总预算：{$info.budget}元 <br>
<a href="__URL__/hard" target="_blank">硬装预算</a> <a href="__URL__/soft" target="_blank">软装预算</a><br>
实际费用：{$total}元
</div>

<div style="float:left;width:980px;border-top:1px dashed #999;padding-top:10px;margin-top:5px;">
<form method="post" action="">
<table>
	<tr><td width="200">名称</td><td width="200">预计费用</td><td width="300">实际费用</td></tr>
	<foreach name="hard_fields" item="vo" key="field">
	<tr><td><a href="__URL__/child/type/{$field}">{$vo[0]}</a></td><td><span id="fee_{$field}">{$hard_budget[$field]}</span>元</td><td><input type="text" id="{$field}" name="{$field}" value="{$hard_realfee[$field]}" />元</td></tr>
	</foreach>
	<tr><td colspan="3" style="border-top:1px solid #ccc;"></td></tr>
	<foreach name="soft_fields" item="vo" key="field">
	<tr><td><a href="__URL__/child/type/{$field}/realfee/{$soft_realfee[$field]}">{$vo[0]}</a></td><td><span id="fee_{$field}">{$soft_budget[$field]}</span>元</td><td><input type="text" id="{$field}" name="{$field}" value="{$soft_realfee[$field]}" />元</td></tr>
	</foreach>
</table>
<br>
<input type="submit" value="保 存" />
</form>
</div>

</div>
<script>
	
$(function(){
	_updatePie('hard', getValData('hard'));
	_updatePie('soft', getValData('soft'));
	
	$("#tab_hard").click(function(){
		$("#hard_div").show();
		$("#soft_div").hide();
	});
	
	$("#tab_soft").click(function(){
		$("#hard_div").hide();
		$("#soft_div").show();
	});
});

function getValData(type) {
	var data = {};
	if (type == 'hard') {
		<foreach name="hard_fields" item="vo" key="field">
			data.{$field} = $("#{$field}").val();
		</foreach>
	} else {
		<foreach name="soft_fields" item="vo" key="field">
			data.{$field} = $("#{$field}").val();
		</foreach>
	}
	
	return data;
}

function _updatePie(type, data) {
	var total = 0;
	var strData = '';
	if (type == 'hard') {
		<foreach name="hard_fields" item="vo" key="field">
			strData += data.{$field} + ",";
			total += parseInt(data.{$field});
		</foreach> 
	} else {
		<foreach name="soft_fields" item="vo" key="field">
			strData += data.{$field} + ",";
			total += parseInt(data.{$field});
		</foreach> 
	}


	total = total / 100;
	
	var sum = 0;var last_field = '';
	if (type == 'hard') {
		<foreach name="hard_fields" item="vo" key="field">
			var scale_{$field} = Math.round(data.{$field}/total);
			sum += scale_{$field};
			last_field = '{$field}';
			
			$("#scale_{$field}").html(scale_{$field});
		</foreach> 
	} else {
		<foreach name="soft_fields" item="vo" key="field">
			var scale_{$field} = Math.round(data.{$field}/total);
			sum += scale_{$field};
			last_field = '{$field}';
			
			$("#scale_{$field}").html(scale_{$field});
		</foreach> 
	}

	var last = parseInt($("#scale_" + last_field).html()) + 100 - sum;
	$("#scale_" + last_field).html(last);

	strData = strData.substr(0, strData.length - 1);

	if (type == 'hard') {
		$("#hard_pie_image").attr("src", "__URL__/pie/data/" + strData);
	} else {
		$("#soft_pie_image").attr("src", "__URL__/softpie/data/" + strData);
	}
}
</script>

<include file="Public:bottom" />